<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>D·ª± ƒëo√°n tƒÉng huy·∫øt √°p</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font + Icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Tailwind CDN (n·∫øu b·∫°n ƒëang d√πng) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="auth.js"></script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <!-- Menu -->
    <div id="menu-container"></div>
    <script>
        fetch("menu.html")
            .then(res => res.text())
            .then(html => {
                document.getElementById("menu-container").innerHTML = html;
                const socket = io();
                socket.on('pill/data/status', (status) => {
                    const jsonStatus = JSON.parse(status);
                    const wifiIcon = document.getElementById('wifi-status');
                    if (!wifiIcon) console.log('wifiIcon not found');
                    console.log(jsonStatus.status);
                    if (jsonStatus.status === 'online') {
                        wifiIcon.innerHTML = 'üì∂';
                        wifiIcon.className = 'text-green-500 text-xl md:text-2xl animate-pulse';
                        wifiIcon.title = 'ƒê√£ k·∫øt n·ªëi IoT';
                    } else {
                        wifiIcon.innerHTML = 'üì¥';
                        wifiIcon.className = 'text-red-500 text-xl md:text-2xl';
                        wifiIcon.title = 'M·∫•t k·∫øt n·ªëi IoT';
                    }
                });
            });
        function toggleMenu() {
            const menu = document.getElementById('mobile-menu');
            if (menu) menu.classList.toggle('hidden');
        }
    </script>

    <main class="pt-32 pb-16 px-6 w-full max-w-5xl flex flex-col items-center">


        <div class="bg-white shadow-lg rounded-xl p-8 w-full max-w-2xl">
            <header class="text-center mb-12">
                <h2 class="text-2xl font-bold text-center mb-6 text-red-700">
                    ü´Ä D·ª± ƒëo√°n nguy c∆° tƒÉng huy·∫øt √°p
                </h2>
            </header>

            <form id="predictForm" class="space-y-4">

                <!-- Gi·ªõi t√≠nh -->
                <div class="flex items-center">
                    <i class="fas fa-venus-mars text-blue-600 w-6"></i>
                    <label class="w-1/3 font-medium">Gi·ªõi t√≠nh</label>
                    <select name="male" class="w-2/3 p-2 border rounded-lg" required>
                        <option value="1">Nam</option>
                        <option value="0">N·ªØ</option>
                    </select>
                </div>

                <!-- Tu·ªïi -->
                <div class="flex items-center">
                    <i class="fas fa-user text-gray-600 w-6"></i>
                    <label class="w-1/3 font-medium">Tu·ªïi</label>
                    <input type="number" name="age" min="1" required class="w-2/3 p-2 border rounded-lg">
                </div>

                <!-- H√∫t thu·ªëc -->
                <div class="flex items-center">
                    <i class="fas fa-smoking text-gray-700 w-6"></i>
                    <label class="w-1/3 font-medium">H√∫t thu·ªëc</label>
                    <select name="currentSmoker" class="w-2/3 p-2 border rounded-lg">
                        <option value="0">Kh√¥ng</option>
                        <option value="1">C√≥</option>
                    </select>
                </div>

                <!-- S·ªë ƒëi·∫øu/ng√†y -->
                <div class="flex items-center">
                    <i class="fas fa-fire text-orange-600 w-6"></i>
                    <label class="w-1/3 font-medium">ƒêi·∫øu/ng√†y</label>
                    <input type="number" name="cigsPerDay" min="0" class="w-2/3 p-2 border rounded-lg" value="0">
                </div>

                <!-- Thu·ªëc huy·∫øt √°p -->
                <div class="flex items-center">
                    <i class="fas fa-pills text-purple-600 w-6"></i>
                    <label class="w-1/3 font-medium">D√πng thu·ªëc HA</label>
                    <select name="BPMeds" class="w-2/3 p-2 border rounded-lg">
                        <option value="0">Kh√¥ng</option>
                        <option value="1">C√≥</option>
                    </select>
                </div>

                <!-- Ti·ªÉu ƒë∆∞·ªùng -->
                <div class="flex items-center">
                    <i class="fas fa-syringe text-red-500 w-6"></i>
                    <label class="w-1/3 font-medium">Ti·ªÉu ƒë∆∞·ªùng</label>
                    <select name="diabetes" class="w-2/3 p-2 border rounded-lg">
                        <option value="0">Kh√¥ng</option>
                        <option value="1">C√≥</option>
                    </select>
                </div>

                <!-- Huy·∫øt √°p t√¢m thu -->
                <div class="flex items-center">
                    <i class="fas fa-heartbeat text-red-700 w-6"></i>
                    <label class="w-1/3 font-medium">HA t√¢m thu</label>
                    <input type="number" name="sysBP" required class="w-2/3 p-2 border rounded-lg">
                </div>

                <!-- Huy·∫øt √°p t√¢m tr∆∞∆°ng -->
                <div class="flex items-center">
                    <i class="fas fa-heart text-pink-600 w-6"></i>
                    <label class="w-1/3 font-medium">HA t√¢m tr∆∞∆°ng</label>
                    <input type="number" name="diaBP" required class="w-2/3 p-2 border rounded-lg">
                </div>

                <!-- BMI -->
                <div class="flex items-center">
                    <i class="fas fa-weight-scale text-green-600 w-6"></i>
                    <label class="w-1/3 font-medium">BMI</label>
                    <input type="number" step="0.1" name="BMI" required class="w-2/3 p-2 border rounded-lg">
                </div>

                <!-- Nh·ªãp tim -->
                <div class="flex items-center">
                    <i class="fas fa-wave-square text-indigo-600 w-6"></i>
                    <label class="w-1/3 font-medium">Nh·ªãp tim</label>
                    <input type="number" name="heartRate" required class="w-2/3 p-2 border rounded-lg">
                </div>

                <!-- Button -->
                <button type="submit" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition">
                    üîç D·ª± ƒëo√°n
                </button>
            </form>

            <!-- Result -->
            <div id="result" class="mt-6 text-center"></div>
        </div>
    </main>

    <script>
        document.getElementById("predictForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            for (let k in data) {
                data[k] = data[k] === "" ? null : Number(data[k]);
            }

            try {
                const res = await fetch("/api/predict", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                });

                const result = await res.json();

                document.getElementById("result").innerHTML = `
                    <h4 class="text-xl font-semibold mb-2 text-green-600">K·∫øt qu·∫£:</h4>
                    <p><b>M·ª©c huy·∫øt √°p:</b> ${result.BP_Level}</p>
                    <p><b>X√°c su·∫•t tƒÉng huy·∫øt √°p:</b> ${result.Hypertension_Risk}</p>
                `;
            } catch (err) {
                document.getElementById("result").innerHTML =
                    `<p class="text-red-500">L·ªói d·ª± ƒëo√°n</p>`;
            }
        });
    </script>


</body>

</html>