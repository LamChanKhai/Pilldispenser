<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‚è∞ H·∫πn Gi·ªù U·ªëng Thu·ªëc</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="auth.js"></script>
</head>

<body class="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 flex flex-col items-center justify-start">

  <!-- Menu -->
  <div id="menu-container"></div>
  <script>
    fetch("menu.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("menu-container").innerHTML = html;
        const socket = io();
        socket.on('pill/data/status', (status) => {
          const jsonStatus = JSON.parse(status);
          const wifiIcon = document.getElementById('wifi-status');
          if(!wifiIcon) console.log('wifiIcon not found');
          console.log(jsonStatus.status);
          if(jsonStatus.status === 'online') {
            wifiIcon.innerHTML = 'üì∂';
            wifiIcon.className = 'text-green-500 text-xl md:text-2xl animate-pulse';
            wifiIcon.title = 'ƒê√£ k·∫øt n·ªëi IoT';
          } else {
            wifiIcon.innerHTML = 'üì¥';
            wifiIcon.className = 'text-red-500 text-xl md:text-2xl';
            wifiIcon.title = 'M·∫•t k·∫øt n·ªëi IoT';
          }
        });
      });
    function toggleMenu() {
      const menu = document.getElementById('mobile-menu');
      if (menu) menu.classList.toggle('hidden');
    }
  </script>

  <!-- N·ªôi dung ch√≠nh -->
  <main class="mt-28 px-4 sm:px-6 md:px-8 w-full flex flex-col items-center">
    <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800 mb-10 text-center tracking-tight">
      ‚è∞ H·∫πn Gi·ªù U·ªëng Thu·ªëc
    </h1>

    <!-- Grid khung ch·ªânh gi·ªù -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl w-full">
      
      <!-- S√°ng -->
      <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 p-6 md:p-8 border border-transparent hover:border-blue-200">
        <h2 class="text-2xl font-semibold text-gray-900 mb-6 text-center">üåÖ Bu·ªïi S√°ng</h2>
        <div class="space-y-5">
          <div class="flex flex-col">
            <label for="gioSang" class="font-semibold text-gray-700 mb-2">Gi·ªù u·ªëng:</label>
            <input type="time" id="gioSang"
                   class="border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-all duration-200" required>
          </div>
        </div>
      </div>

      <!-- T·ªëi -->
      <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 p-6 md:p-8 border border-transparent hover:border-indigo-200">
        <h2 class="text-2xl font-semibold text-gray-900 mb-6 text-center">üåô Bu·ªïi T·ªëi</h2>
        <div class="space-y-5">
          <div class="flex flex-col">
            <label for="gioToi" class="font-semibold text-gray-700 mb-2">Gi·ªù u·ªëng:</label>
            <input type="time" id="gioToi"
                   class="border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 transition-all duration-200" required>
          </div>
        </div>
      </div>

    </div>

    <!-- N√∫t L∆∞u -->
    <div class="mt-10">
      <button onclick="luuThoiGian()"
              class="bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-semibold px-8 py-3 rounded-xl shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300">
        üíæ L∆∞u
      </button>
    </div>

    <!-- Footer -->
    <footer class="mt-12 md:mt-16 text-gray-500 text-xs md:text-sm text-center">
      ¬© 2025 Smart Health Box ‚Äî by <b class="text-blue-600">????????????.pt</b>
    </footer>
  </main>

  <script>
    async function luuThoiGian() {
      const gioSang = document.getElementById("gioSang").value;
      const gioToi = document.getElementById("gioToi").value;
      const data = {
        mode: "quick",
        sang: gioSang,
        toi: gioToi
      };
      try {
        const response = await fetch('/api/v1/schedule', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });
        if (response.ok) {
          const result = await response.json();
          alert(result.message);
        } else {
          const errorData = await response.json();
          alert('L·ªói: ' + errorData.message);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('L·ªói khi k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß.');
      }
    }
  </script>
</body>
</html>
