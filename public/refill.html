<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>N·∫°p Thu·ªëc - H·ªôp Thu·ªëc Th√¥ng Minh</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    .pill-container {
      position: relative;
      width: 500px;
      height: 500px;
      margin: 0 auto;
    }

    .compartment {
      cursor: default;
    }

    .compartment.empty {
      fill: #e5e7eb;
    }

    .compartments-group {
      transform-origin: 250px 250px;
      transition: transform 0.5s ease-in-out;
    }

    .center-button {
      cursor: pointer;
      transition: filter 0.3s ease;
      transform-origin: 250px 250px;
    }

    .center-button:hover {
      filter: brightness(1.1);
    }

    .center-button:active {
      filter: brightness(0.9);
    }

    @media (max-width: 640px) {
      .pill-container {
        width: 350px;
        height: 350px;
      }
    }
  </style>
</head>

<body class="min-h-screen bg-[#F8FAFC] flex flex-col items-center">
  <!-- Menu -->
  <div id="menu-container"></div>
  <script>
    fetch("menu.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("menu-container").innerHTML = html;
        const socket = io();
        socket.on('pill/data/status', (status) => {
          const jsonStatus = JSON.parse(status);
          const wifiIcon = document.getElementById('wifi-status');
          if (!wifiIcon) console.log('wifiIcon not found');
          console.log(jsonStatus.status);
          if (jsonStatus.status === 'online') {
            wifiIcon.innerHTML = 'üì∂';
            wifiIcon.className = 'text-green-500 text-xl md:text-2xl animate-pulse';
            wifiIcon.title = 'ƒê√£ k·∫øt n·ªëi IoT';
          } else {
            wifiIcon.innerHTML = 'üì¥';
            wifiIcon.className = 'text-red-500 text-xl md:text-2xl';
            wifiIcon.title = 'M·∫•t k·∫øt n·ªëi IoT';
          }
        });
      });
    function toggleMenu() {
      const menu = document.getElementById('mobile-menu');
      if (menu) menu.classList.toggle('hidden');
    }
  </script>

  <main class="pt-28 pb-12 px-4 sm:px-6 md:px-8 w-full max-w-6xl flex flex-col items-center">
    <h1 class="text-2xl md:text-3xl font-extrabold text-gray-800 mb-10 text-center tracking-tight">
      üíä N·∫°p Thu·ªëc
    </h1>

    <div class="bg-white rounded-3xl shadow-sm border border-gray-100 p-6 md:p-8 w-full max-w-2xl">
      <div class="flex items-center gap-2 mb-6 text-[#1E293B] font-bold text-xl">
        <span class="text-blue-500 inline-block">üì¶</span> 
        <span class="inline-block">Ch·ªçn ngƒÉn ƒë·ªÉ n·∫°p thu·ªëc</span>
      </div>

      <!-- H√¨nh tr√≤n v·ªõi 15 ngƒÉn -->
      <div class="pill-container">
        <svg width="100%" height="100%" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <filter id="shadow">
              <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.3"/>
            </filter>
          </defs>
          
          <!-- 15 ngƒÉn ngo√†i -->
          <g id="outer-compartments" class="compartments-group">
            <!-- C√°c ngƒÉn s·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JavaScript -->
          </g>

          <!-- N√∫t trung t√¢m (h√¨nh tr√≤n) -->
          <circle 
            id="center-button-circle"
            class="center-button"
            cx="250" 
            cy="250" 
            r="60" 
            fill="#3b82f6"
            filter="url(#shadow)"
            onclick="rotateCompartments()"
          />
          <text 
            x="250" 
            y="260" 
            text-anchor="middle" 
            font-size="16" 
            font-weight="bold" 
            fill="white"
            pointer-events="none"
          >üîÑ</text>
        </svg>
      </div>


    </div>
  </main>

  <script>
    const centerX = 250;
    const centerY = 250;
    const outerRadius = 180;
    const innerRadius = 80;
    const totalCompartments = 15;
    let rotationAngle = 0;

    const svg = document.querySelector('svg');
    const outerCompartments = document.getElementById('outer-compartments');

    // T·∫°o 15 ngƒÉn ngo√†i, m·ªói ngƒÉn c√≥ g√≥c 360/15 = 24 ƒë·ªô
    const angleStep = 360 / totalCompartments; // 24 ƒë·ªô m·ªói ngƒÉn

    for (let i = 0; i < totalCompartments; i++) {
      const compartmentNumber = i + 1;
      
      // T√≠nh g√≥c cho ngƒÉn n√†y (b·∫Øt ƒë·∫ßu t·ª´ tr√™n, ƒëi theo chi·ªÅu kim ƒë·ªìng h·ªì)
      const angle = i * angleStep;
      
      // Chuy·ªÉn ƒë·ªïi sang radian v√† ƒëi·ªÅu ch·ªânh ƒë·ªÉ b·∫Øt ƒë·∫ßu t·ª´ tr√™n (0 ƒë·ªô = tr√™n c√πng)
      const angleRad = ((angle - 90) * Math.PI) / 180;
      
      // T√≠nh to√°n v·ªã tr√≠ cho ngƒÉn h√¨nh qu·∫°t
      const compartmentAngle = angleStep * (Math.PI / 180); // G√≥c c·ªßa m·ªói ngƒÉn
      const startAngle = angleRad - (compartmentAngle / 2);
      const endAngle = angleRad + (compartmentAngle / 2);
      
      // NgƒÉn 15 ƒë·ªÉ tr·ªëng - kh√¥ng t·∫°o path
      if (compartmentNumber !== 15) {
        // T·∫°o path cho ngƒÉn h√¨nh qu·∫°t
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        const x1 = centerX + outerRadius * Math.cos(startAngle);
        const y1 = centerY + outerRadius * Math.sin(startAngle);
        const x2 = centerX + outerRadius * Math.cos(endAngle);
        const y2 = centerY + outerRadius * Math.sin(endAngle);
        const x3 = centerX + innerRadius * Math.cos(endAngle);
        const y3 = centerY + innerRadius * Math.sin(endAngle);
        const x4 = centerX + innerRadius * Math.cos(startAngle);
        const y4 = centerY + innerRadius * Math.sin(startAngle);
        
        const pathData = `M ${x1} ${y1} A ${outerRadius} ${outerRadius} 0 0 1 ${x2} ${y2} L ${x3} ${y3} A ${innerRadius} ${innerRadius} 0 0 0 ${x4} ${y4} Z`;
        
        path.setAttribute('d', pathData);
        path.setAttribute('id', `compartment-${compartmentNumber}`);
        path.setAttribute('class', 'compartment empty');
        path.setAttribute('filter', 'url(#shadow)');
        
        outerCompartments.appendChild(path);
      }
      
      // Th√™m s·ªë ngƒÉn (k·ªÉ c·∫£ ngƒÉn 15)
      const labelAngle = angleRad;
      const labelRadius = (outerRadius + innerRadius) / 2;
      const labelX = centerX + labelRadius * Math.cos(labelAngle);
      const labelY = centerY + labelRadius * Math.sin(labelAngle);
      
      const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      text.setAttribute('x', labelX);
      text.setAttribute('y', labelY);
      text.setAttribute('text-anchor', 'middle');
      text.setAttribute('font-size', '14');
      text.setAttribute('font-weight', 'bold');
      text.setAttribute('fill', '#4b5563');
      text.setAttribute('pointer-events', 'none');
      text.textContent = compartmentNumber;
      
      outerCompartments.appendChild(text);
    }

    function rotateCompartments() {
      // Xoay c√°c ngƒÉn m·ªôt g√≥c 360/15 (m·ªôt v·ªã tr√≠)
      fetch('/schedule/refill')
        .then(res => res.json())
        .then(data => {
          console.log(data);
        });
      rotationAngle += (360 / 15);
      const compartmentsGroup = document.getElementById('outer-compartments');
      compartmentsGroup.style.transform = `rotate(${rotationAngle}deg)`;
    }
  </script>
</body>

</html>

